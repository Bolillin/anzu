<main class="global-content massdrop top-info">
  <div class="container">
    <div class="row mb-20">
      <div class="col-md-12">
        <h1 ng-cloak>{{ product.full_name }}</h1>

        <div class="row">
          <div class="col-md-6">
            <ol class="breadcrumb">
              <li><a href="/compra-en-legion" alt="Compras en Legión">Compras en Legión</a></li>
              <li class="active">{{ product.full_name }}</li>
            </ol>
          </div>

          <div class="col-md-6">
            <div class="text-right">
              <a href="" ng-click="share_fb()" rel="nofollow" target="_blank" class="btn btn-fb"><i class="fa fa-facebook-official"></i> <span class="hidden-xs">Compartir en FB</span></a>
              <a href="https://twitter.com/intent/tweet?text=Quiero%20comprar%20el%20{{product.name}},%20si%20tambi%C3%A9n%20est%C3%A1s%20interesado,%20podremos%20obtener%20un%20precio%20m%C3%A1s%20bajo%20juntos...%20&url=https://spartangeek.com/compra-en-legion/{{product.slug}}&original_referer=https://spartangeek.com/compra-en-legion/{{product.slug}}" class="btn btn-twitter"><i class="fa fa-twitter"></i> <span class="hidden-xs">Compartir en Twitter</span></a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
<main class="massdrop">
  <div class="container">
    <div class="row mb-40">
      <div class="col-md-8">

        <div class="cover">
          <img ng-src="{{ massdrop.cover }}" alt="{{ massdrop.name }}">
        </div>

        <section class="checkpoints-diagram">
          <h2 ng-if="massdrop.active">Quedan <span ng-if="counter.days > 0">{{ counter.days }} días, </span>{{ counter.hours }} horas<span ng-if="counter.days < 1">, {{ counter.minutes }} minutos</span> <small ng-if="massdrop.starting_price > massdrop.price">Comenzó en {{ massdrop.starting_price | currency:'$ ':0 }}</small></h2>
          <h2 ng-if="!massdrop.active">La Compra en legión ha finalizado <small>Comenzó en {{ massdrop.starting_price | currency:'$ ':0 }}</small></h2>
          <p class="join" ng-if="massdrop.active">¡Aparta ahora y ayuda a conseguir {{ massdrop.timespan }} horas más!</p>
          <div class="cp-bar">
            <div class="current-progress" style="width: {{ massdrop.reservations_width }}%"></div>

            <div class="checkpoints">
              <div class="checkpoint" ng-class="{'reached': c.done}" ng-repeat="c in massdrop.checkpoints" style="right: {{ c.from_right }}%;">
                <div class="details">
                  <h3>{{ c.price | currency:'$ ':0}}</h3>
                  <span class="persons-needed" ng-if="c.done">{{ c.starts }} unidas</span>
                  <span class="persons-needed" ng-if="!c.done">Si se unen {{ c.starts }}</span>
                </div>
                <div class="extra-time" ng-if="c.timespan > 0">
                  <span>{{c.timespan}} horas extra</span>
                </div>
              </div>
            </div>
          </div>
          <div class="row current-stats">
            <div class="col-md-6">
              <div class="reached text-center"><strong>{{ massdrop.count_reservations }}</strong> Personas se unieron a la legión</div>
            </div>
            <div class="col-md-6">
              <div class="interested text-center"><strong>{{ massdrop.count_interested }}</strong> Personas interesadas en unirse</div>
            </div>
          </div>
        </section>

        <p class="alert alert-info">Esto es una compra en legión. Si no sabes qué significa, revisa nuestra sección <strong><a href="/compra-en-legion/faq" target="_blank">"¿Qué es una compra en legión?"</a></strong> para encontrar más detalles.</p>

        <section>
          <h3>Descripción</h3>

          <section marked="massdrop.content"></section>
        </section>

        <section>
          <h3>Envío</h3>

          <p>Envíos a todo México por diferentes paqueterías.</p>
          <p>Costo de envío: <strong>$ 139</strong> - No aplica en zona extendida.</p>
          <p>Fecha estimada de envío: <strong>{{ massdrop.shipping_date_label }}</strong>.</p>
          <p>Tiempo de entrega: 2 días hábiles, excepto zona extendida</p>
          <p>Al finalizar la Compra en Legión, recibirás un correo con toda la información.</p>
        </section>

        <section>
          <h3>Entregas en la Ciudad de México</h3>
          <p>Durante la semana del {{ massdrop.shipping_date_label }} se establecerán horarios para recoger tu compra personalmente <strong>sin costo</strong>.</p>
          <p>El lugar será en un punto de la delegación Benito Juárez.</p>
        </section>

        <hr>

        <p>Si tienes más dudas, revisa nuestra sección <strong><a href="/compra-en-legion/faq" target="_blank">"¿Qué es una compra en legión?"</a></strong> para encontrar más detalles.</p>

      </div>

      <!-- Sidebar -->
      <div class="col-md-4">
        <section class="mb-40">
          <div class="prices-widget">
            <div class="prices-bar">
              <div class="bar-progress" style="height: {{ massdrop.reservations_width*.8 + 20 }}%"></div>
            </div>
            <div class="price-labels">
              <div class="price-label">
                <span class="content completed">{{ product.store.vendors.spartangeek.price | currency:'$ ':0 }} (Precio normal)</span>
              </div>
            </div>
            <div class="price-labels" style="top: 20%">
              <div class="price-label">
                <span class="content" ng-class="{'current': massdrop.starting_price == massdrop.price, 'completed': massdrop.starting_price > massdrop.price}">{{ massdrop.starting_price | currency:'$ ':0 }} (Precio inicial)</span>
              </div>
            </div>
            <div class="price-labels" ng-repeat="c in massdrop.checkpoints" style="top: {{ 100 - c.from_right*.8 }}%;">
              <div class="price-label">
                <span class="content" ng-class="{'current': c.price == massdrop.price,'completed': c.price > massdrop.price}">{{ c.price | currency:'$ ':0 }} <span ng-if="$last">(Objetivo)</span></span>
              </div>
            </div>
          </div>
        </section>
        <section class="mb-40">
          <div class="price">
            <h2>{{ massdrop.price | currency:'$ ':0 }}</h2>
            <span class="description join" ng-if="massdrop.active">Aparta con {{ massdrop.reserve_price | currency:'$ ':0 }}</span>
            <span class="description" ng-if="massdrop.active">Paga <strong>la diferencia</strong> cuanto termine la compra en legión</span>
            <h3 ng-if="massdrop.active">Quedan <span ng-if="counter.days > 0">{{ counter.days }} días, </span>{{ counter.hours }} horas<span ng-if="counter.days < 1">, {{ counter.minutes }} minutos</span></h3>
            <h3 ng-if="!massdrop.active">La Compra en legión ha finalizado</h3>
          </div>

          <div class="buttons mb-20">
            <a href="/compra-en-legion/{{product.slug}}/unirme" class="btn btn-block btn-success" ng-if="(counter.hours > 0 || counter.minutes > 0) && massdrop.active">Comprar</a>
          </div>

          <table class="table">
            <tr>
              <th>Envíos a</th>
              <td>México</td>
            </tr>
            <tr>
              <th>Precio en tienda</th>
              <td><a href="/componentes/video-card/{{product.slug}}" target="_blank">{{ product.store.vendors.spartangeek.price | currency:'$ ':0 }} en SpartanGeek</a></td>
            </tr>
          </table>
          <p>El precio en tienda es el total a pagar si <strong>no</strong> quieres <em>compra en legión</em>. Además, será el precio que tendrá cuando termine la compra en legión.</p>

          <div class="buttons">
            <a href="" class="btn btn-block btn-default" ng-click="signIn()" ng-if="!user.isLogged">Recibir alertas de precios</a>
            <a href="" class="btn btn-block btn-default" ng-click="interestedDialog()" ng-if="user.isLogged && !massdrop.interested && massdrop.current != 'reservation'">Recibir alertas de precios</a>
            <a href="" class="btn btn-block btn-warning" ng-click="interested()" ng-if="user.isLogged && massdrop.interested && massdrop.current != 'reservation'">Recibir alertas de precios</a>
          </div>
        </section>

        <section>
          <h4>Actividad reciente</h4>

          <p class="alert alert-info" ng-if="!massdrop.activities" ng-cloak>No hay actividad aún.</p>

          <div class="user-activity" ng-repeat="a in massdrop.activities" ng-class="{'checkpoint': a.type == 'checkpoint'}">
            <a href="" title="Checkpoint alcanzado" class="avatar-container" ng-if="a.type == 'checkpoint'">
              <img class="avatar" src="/images/massdrop/icon_timeplus.png" alt="Time checkpoint">
            </a>
            <a href="/u/{{ a.attributes.user.username}}/{{ a.attributes.user.id }}" title="Perfil de {{ a.attributes.user.username}}" class="avatar-container" ng-if="a.type == 'reservation' || a.type == 'interested'" target="_blank">
              <img class="avatar" ng-src="{{ a.attributes.user.image }}" alt="{{ a.attributes.user.username }}" ng-if="a.attributes.user.image">
              <span class="avatar" title="{{ a.attributes.user.username }}" ng-if="!a.attributes.user.image">{{ a.attributes.user.username[0] }}</span>
            </a>
            <div class="username" ng-if="a.type == 'checkpoint'">
              <strong>Checkpoint</strong> alcanzado por la legión
            </div>
            <div class="username" ng-if="a.type == 'reservation' || a.type == 'interested'">
              <a href="/u/{{ a.attributes.user.username}}/{{ a.attributes.user.id }}" title="Perfil de {{ a.attributes.user.username}}" class="ng-binding" target="_blank">
                {{ a.attributes.user.username }}
              </a>
            </div>
            <div class="description" ng-if="a.type == 'checkpoint'">
              Se agregó más tiempo a la <strong>Compra en Legión</strong>
            </div>
            <div class="description" ng-if="a.type == 'reservation'">
              <strong style="color: #21b384;"><i class="fa fa-check" aria-hidden="true"></i> Compró <span ng-if="massdrop.active">{{a.created_at | timeAgo}}</span></strong>
            </div>
            <div class="description" ng-if="a.type == 'interested'">
              Está interesado <span ng-if="massdrop.active">desde {{a.created_at | timeAgo}}</span>
            </div>
          </div>

          <textarea class="form-control mb-40" rows="8" ng-if="can('sensitive-data')">{{ usersInfo() }}</textarea>
        </section>
      </div>
    </div>
  </div>
</main>