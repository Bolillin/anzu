  <main class="main-reader">
    <div class="row row-no-padding">
      <div class="col-md-4 col-sm-5" ng-class="{'hidden-xs': activePostId != null}">
        <div class="row row-no-padding">
          <div class="col-md-12">
            <div class="feed-sidebar">
              <div class="category-selector">
                <div id="actions" class="row" ng-if="user.isLogged">
                  <div class="" ng-class="{'col-xs-12': category.slug != null, 'col-xs-8': category.slug == null}">
                    <a href="/" ng-if="category.slug != null" style="margin-right: 1rem;" ng-click="toggleCategories()"><h2><i class="fa fa-chevron-left"></i></h2></a>
                    <h2>{{ category.name || "Mi Feed personal" }}</h2>
                  </div>
                  <div class="col-xs-4 text-right" ng-if="category.id == null">
                    <a class="toggle" href="" ng-click="toggleCategories()" ng-if="status.show_categories"><i class="fa fa-chevron-up"></i> Terminar</a>
                    <a class="toggle" href="" ng-click="toggleCategories()" ng-if="!status.show_categories"><i class="fa fa-chevron-down"></i> Configurar</a>
                  </div>
                </div>
                <div id="actions" class="row" ng-if="!user.isLogged">
                  <div class="" ng-class="{'col-xs-12': category.slug != null, 'col-xs-8': category.slug == null}">
                    <a href="/" ng-if="category.slug != null" style="margin-right: 1rem;" ng-click="toggleCategories()"><h2><i class="fa fa-chevron-left"></i></h2></a>
                    <h2>{{ category.name || "Categorías disponibles" }}</h2>
                  </div>
                  <div class="col-xs-4 text-right" ng-if="category.id == null">
                    <a class="toggle" href="" ng-click="toggleCategories()" ng-if="status.show_categories"><i class="fa fa-chevron-up"></i> Ocultar</a>
                    <a class="toggle" href="" ng-click="toggleCategories()" ng-if="!status.show_categories"><i class="fa fa-chevron-down"></i> Mostrar</a>
                  </div>
                </div>
                <div id="instructions" ng-if="user.isLogged && status.show_categories">
                  <div class="row">
                    <div class="col-xs-12">
                      <p>Puedes personalizar la lista de publicaciones seleccionando únicamente las categorías que te interesan</p>
                      <div class="text-right" ng-if="user.info.categories.length < 63 || ! user.info.categories">
                        <span class="see-in-feed">Suscribirme a todas</span>
                        <switch id="enabled" name="enabled" ng-model="dummy" ng-change="subscribeToAll()" on="Si" off="No" class="sg"></switch>
                      </div>
                    </div>
                  </div>
                </div>
                <div id="category-list" ng-if="status.show_categories" style="overflow-y: scroll;" adjust-height>
                  <ul>
                    <li ng-repeat="c in categories">
                      <div class="category-header" ng-style="{'background': 'url(/images/boards/' + c.slug + '.png)'}">
                        <div class="layer"></div>
                        <div class="content">
                          <h4>{{c.name}}</h4>
                          <p>{{c.description}}</p>
                        </div>
                      </div>
                      <ul class="subcategories">
                        <li ng-repeat="s in c.subcategories">
                          <div class="row">
                            <div class="col-md-6 col-xs-6">
                              <a href="/c/{{ s.slug }}" tooltip="Haz click para ver sólo esta categoría" tooltip-placement="right">{{ s.name }}</a>
                            </div>
                            <div class="col-md-6 col-xs-6 text-right" ng-if="user.isLogged">
                              <span class="see-in-feed">Suscribirme</span>
                              <switch id="enabled" name="enabled" ng-model="s.selected" ng-change="toggleSubscription(s)" on="Si" off="No" class="sg"></switch>
                            </div>
                          </div>
                        </li>
                      </ul>
                    </li>
                  </ul>
                </div>
              </div>

              <div class="feed-type-actions" ng-if="!status.show_categories">
                <div class="row">
                  <div class="col-xs-12">
                    <div class="btn-toolbar">
                      <div class="btn-group">
                        <label class="btn btn-default btn-sm" ng-model="viewing.top_posts" btn-radio="false"><span class="hidden-xs hidden-sm hidden-md label">Ver todas</span><span class="hidden-lg label">Todas</span></label>
                        <label class="btn btn-default btn-sm" ng-model="viewing.top_posts" btn-radio="true" ng-click="getTopFeed()"><span class="hidden-xs hidden-sm hidden-md label">Ver más populares</span><span class="hidden-lg label">Populares</span></label>
                      </div>
                      <a href="" class="btn btn-default btn-sm" ng-click="getTopFeed()" ng-if="viewing.top_posts"><i class="fa fa-refresh"></i></a>

                      <a href="/post/create/{{ category.slug }}" class="btn btn-primary btn-sm" style="float:right;" ng-if="user.isLogged"><span class="label">Crear publicación</span></a>
                      <a href="" ng-click="signIn()" class="btn btn-primary btn-sm" style="float:right;" ng-if="!user.isLogged"><span class="label">Crear publicación</span></a>
                    </div>
                  </div>
                </div>
              </div>

              <div class="new-posts-carlos" ng-cloak ng-if="status.pending.$value > 0 && !status.show_categories" ng-click="get_newer()" ng-class="{'loading': resolving.newer}">
                <span ng-if="!resolving.newer">Ver {{ status.pending.$value }} {{ status.pending.$value == 1?'publicación nueva':'publicaciones nuevas' }}</span>
                <span ng-if="resolving.newer">Cargando...</span>
              </div>

              <div class="no-feed-error" ng-if="posts.length == 0 && resolving.loaded && category.id != null">
                No hay publicaciones en esta categoría. Sé el primero en <a href="/post/create/{{ category.slug }}">escribir una publicación</a>.
              </div>

              <div class="no-feed-error" ng-if="posts.length == 0 && resolving.loaded && category.id == null">
                Estás suscrito sólo a categorías que no tienen publicaciones, <a href="" ng-click="toggleCategories()">agrega más categorías</a> para unirte a alguna conversación.
              </div>

              <ul class="discussions-list" scroll-me="walkFeed()" ng-hide="resolving.categories || viewing.top_posts" adjust-height>
                <li ng-if="false" class="no-list">
                  <h2>Nadie ha publicado en esta categoría</h2>
                  <p>Sé el primero en <a href="/post/create/{{ category.slug }}">escribir una publicación</a>.</p>
                </li>
                <li data-id="{{ post.id }}" class="discussion-summary" ng-class="{'active': post.id === $parent.activePostId, 'unread': post.unread == true}" ng-repeat="post in posts | orderBy:['pinned','-created_at']" ng-cloak>
                  <div>
                    <a href="/u/{{ post.author.username }}/{{ post.author.id }}" class="author" title="Escrito por {{ post.author.username }}">
                      <span class="avatar" title="{{ post.author.username }}" ng-if="!post.author.image">{{ post.author.username[0] }}</span>
                      <img class="avatar" ng-src="{{ post.author.image }}" alt="{{ post.author.username }}" ng-if="post.author.image">
                    </a>
                    <a href="/p/{{ post.slug }}/{{ post.id }}" class="main">
                      <h3 class="title">{{ post.title }}</h3>
                      <ul class="info">
                        <li class="">
                          <span>
                            Escrito por <span class="username">{{ post.author.username }}</span> <time time-ago from-time='{{ post.created_at }}'></time>
                          </span>
                        </li>
                      </ul>
                      <ul class="extra-info">
                        <li class="category" ng-if="category.slug === '' || true">
                          <span class="ball" ng-style="{'background-color': post.category.color}"></span>
                          <span class="name">{{ post.category.name }}</span>
                        </li>
                        <li class="solved" ng-if="post.solved">
                          <i class="fa fa-check-circle"></i> <span>Resuelto</span>
                        </li>
                        <li class="pinned" ng-if="post.pinned">
                          <i class="fa fa-exclamation-circle"></i> <span>Importante</span>
                        </li>
                      </ul>
                    </a>
                    <span class="count">{{ post.comments.count }}<span class="label">{{ post.comments.count==1?'Respuesta':'Respuestas'}}</span></span>
                  </div>
                </li>
                <div class="resolving" ng-if="resolving.older">
                  <i class="fa fa-circle-o-notch fa-spin"></i>
                </div>
              </ul>

              <ul class="discussions-list" ng-if="!resolving.categories && viewing.top_posts" adjust-height>
                <li data-id="{{ post.id }}" class="discussion-summary" ng-class="{'active': post.id === $parent.activePostId, 'unread': post.unread == true}" ng-repeat="post in top_posts" ng-cloak>
                  <div>
                    <a href="/u/{{ post.author.username }}/{{ post.author.id }}" class="author" title="Escrito por {{ post.author.username }}">
                      <span class="avatar" title="{{ post.author.username }}" ng-if="!post.author.image">{{ post.author.username[0] }}</span>
                      <img class="avatar" ng-src="{{ post.author.image }}" alt="{{ post.author.username }}" ng-if="post.author.image">
                    </a>
                    <a href="/p/{{ post.slug }}/{{ post.id }}" class="main">
                      <h3 class="title">{{ post.title }}</h3>
                      <ul class="info">
                        <li class="">
                          <span>
                            Escrito por <span class="username">{{ post.author.username }}</span> <time time-ago from-time="{{ post.created_at}}"></time>
                          </span>
                        </li>
                      </ul>
                      <ul class="extra-info">
                        <li class="category" ng-if="category.slug === '' || true">
                          <span class="ball" ng-style="{'background-color': post.category.color}"></span>
                          <span class="name">{{ post.category.name }}</span>
                        </li>
                        <li class="pinned" ng-if="post.pinned">
                          <i class="fa fa-exclamation-circle"></i> <span>Importante</span>
                        </li>
                      </ul>
                    </a>
                    <span class="count">{{ post.comments.count }}<span class="label">{{ post.comments.count==1?'Respuesta':'Respuestas'}}</span></span>
                  </div>
                </li>
                <div class="resolving" ng-if="resolving_posts">
                  <i class="fa fa-circle-o-notch fa-spin"></i>
                </div>
              </ul>

              <div class="resolving" ng-if="resolving.categories">
                <i class="fa fa-circle-o-notch fa-spin"></i>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-md-8 col-sm-7" ng-class="{'hidden-xs': activePostId == null}">
        <div class="current-article" ng-controller="ReaderViewController" adjust-height>

          <div class="waiting" ng-show="waiting">
            <img src="/images/head.png" />
            <h4>Únete a la conversación</h4>
            <p>Puedes ver a la <strong>izquierda</strong> las publicaciones de otros espartanos, nuestros foros y nuestras recomendaciones, empieza viendo y únete a la conversación.</p>
            <p ng-if="can('debug')">Bienvenido <strong>Developer</strong></p>
          </div>

          <div class="row" ng-show="waiting">
            <div class="col-md-8 col-md-offset-2">
              <form class="form form-search-home" role="search">
                <div class="input-group">
                  <input type="text" class="form-control" placeholder="Buscar publicación o componente..." name="srch-term" id="srch-term" ng-click="show_search()">
                  <div class="input-group-btn">
                    <button class="btn btn-default" type="submit"><i class="fa fa-search search-icon"></i></button>
                  </div>
                </div>
              </form>
              <div class="search-examples">
                <h4>Ejemplos de búsquedas</h4>
                <ul>
                  <li>shanks recomendación pc</li>
                  <li>programmer fechas</li>
                  <li>gtx 970</li>
                  <li>i5 4460</li>
                </ul>
              </div>
            </div>
          </div>

          <div ng-hide="waiting">
            <div class="back-to-list visible-xs-block">
              <a href="/" ng-click="activePostId = null"><i class="fa fa-chevron-left"></i> Regresar al listado de publicaciones</a>
            </div>
            <div class="author" ng-hide="resolving || error_loading">
              <div class="row">
                <div class="col-md-7 col-xs-12">
                  <a href="/u/{{ post.author.username }}/{{ post.author.id }}" title="Perfil de {{ post.author.username }}">
                    <span class="avatar" title="{{ post.author.username }}" ng-if="!post.author.image">{{ post.author.username[0] }}</span>
                    <img class="avatar" ng-src="{{ post.author.image }}" alt="{{ post.author.username }}" ng-if="post.author.image">
                  </a>

                  <div class="user-info">
                    <a href="/u/{{ post.author.username }}/{{ post.author.id }}" title="Perfil de {{ post.author.username }}">
                      <span class="username">{{ post.author.username }}</span>
                    </a>
                    <span class="verified-account" ng-if="post.author.id === '559af1c501c25d3790000054' || post.author.validated" tooltip="Cuenta verificada" tooltip-placement="right"><i class="fa fa-check"></i></span>
                    <ul class="role-labels" ng-if="post.author.roles.length > 0">
                      <li ng-repeat="role in post.author.roles" ng-if="role.name !== 'user'">
                        <span class="label label-default" ng-class="role.name">{{ misc.role_labels[role.name] }}</span>
                      </li>
                    </ul>
                    <div class="description">{{ post.author.description || "Just another Spartan Geek" }}</div>
                    <div class="level">{{ misc.gaming.rules[post.author.gaming.level].name }}</div>

                  </div>
                </div>

                <div class="col-md-5 hidden-xs">
                  <div class="category-preview" ng-style="{'background-image': 'url(/images/boards/' + post.category.parent_slug + '.png)'};">
                    <p class="category-label">{{ post.category.name }}</p>
                  </div>
                </div>
              </div>
            </div>

            <div class="resolving" ng-hide="!resolving">
              <img src="/images/head.png" />
              <h4>Cargando</h4>
              <i class="fa fa-spinner fa-pulse"></i>
            </div>

            <div class="resolving" ng-show="error_loading">
              <img src="/images/head.png" />
              <h4>Error 404</h4>
              <p>No encontramos la publicación que estabas buscando.</p>
            </div>

            <div ng-hide="resolving || error_loading">

              <nav class="discussion-nav">
                <ul>
                  <li class="primary-control" ng-if="!post.comments_blocked">
                    <a class=" btn btn-primary" href="" ng-click="show_composer()" ng-if="user.isLogged">
                      <i class="fa fa-fw fa-reply icon"></i> <span class="label">Responder</span>
                    </a>
                    <a class=" btn btn-primary" href="" ng-click="signIn()" ng-if="!user.isLogged">
                      <i class="fa fa-fw fa-reply icon"></i> <span class="label">Quiero comentar</span>
                    </a>
                  </li>
                  <li class="title-control">
                    <div class="stream-scrubber dropdown hidden-xs">
                      <a href="#" data-toggle="dropdown" class="btn btn-default dropdown-toggle">
                        <span class="index">{{ scrubber.current_c }}</span> de <span class="count">{{ post.comments.count + 1}}</span> mensajes <i class="fa fa-fw fa-sort icon-glyph"></i>
                      </a>
                      <div class="dropdown-menu">
                        <div class="scrubber">
                          <a href="#" class="scrubber-first">
                            <i class="fa fa-fw fa-angle-double-up"></i> Mensaje original
                          </a>
                          <div class="scrubber-scrollbar" style="max-height: 285px; cursor: pointer; -webkit-user-select: none;">
                            <div class="scrubber-before" style="height: 55%;"></div>
                            <div class="scrubber-slider" style="height: 45%; cursor: move;">
                              <div class="scrubber-handle"></div>
                              <div class="scrubber-info" ng-cloak>
                                <strong><span class="index">{{ scrubber.current_c + 1 }}</span> de <span class="count">{{ post.comments.count + 1 }}</span> mensajes</strong>
                                <span class="description" ng-if="scrubber.current_c == 0">{{ post.created_at | date_at }}</span>
                                <span class="description" ng-if="scrubber.current_c > 0">{{ post.comments.set[post.comments.set.length - scrubber.current_c].created_at | date_at }}</span>
                              </div>
                            </div>
                            <div class="scrubber-after" style="height: 0%;"></div>
                          </div>
                          <a href="#" class="scrubber-last"><i class="fa fa-fw fa-angle-double-down"></i> Ahora</a>
                        </div>
                      </div>
                    </div>
                  </li>
                </ul>
              </nav>

              <div class="discussion-posts">
                <div class="float-actions text-right">
                  <div class="btn-group" ng-if="aacl.can('delete', 'posts', user.info, post.author.id, post.category.id)" dropdown>
                    <button type="button" class="button button-icon button-flat" dropdown-toggle>
                      <i class="fa fa-pencil"></i>
                    </button>
                    <ul class="dropdown-menu dropdown-menu-right">
                      <li>
                        <a href="/p/{{post.slug}}/{{post.id}}/edit" ng-if="aacl.can('edit', 'posts', user.info, post.author.id, post.category.id)" ng-click=""><i class="fa fa-pencil"></i> Editar publicación</a>
                      </li>
                      <li>
                        <a href="" ng-if="aacl.can('delete', 'posts', user.info, post.author.id, post.category.id)" ng-click="deletePost()"><i class="fa fa-trash-o"></i> Eliminar publicación</a>
                      </li>
                    </ul>
                  </div>
                </div>

                <h1 class="discussion-title">{{ post.title }}</h1>
                <span class="label label-default label-date">Escrito {{ post.created_at | timeAgo }}</span>

                <div class="content" ng-if="post.type !== 'recommendations'" marked="post.content_final"></div>

                <div class="recommendations" ng-if="post.type === 'recommendations'">
                  <div class="content" marked="post.content_final"></div>

                  <div class="components">
                    <div ng-if="post.components.cpu.content" class="component">
                      <div class="row">
                        <div class="col-md-2 col-sm-3">
                          <img src="/images/components/cpu.png" alt="CPU" />
                        </div>

                        <div class="col-md-10 col-sm-9">
                          <h6>Procesador <span class="status" ng-if="post.components.cpu.status == 'needed'">Lo necesito</span> <span class="status owned" ng-if="post.components.cpu.status == 'owned'">Ya lo tengo</span></h6>
                          {{ post.components.cpu.content }}
                        </div>
                      </div>
                    </div>

                    <div ng-if="post.components.motherboard.content" class="component">
                      <div class="row">
                        <div class="col-md-2 col-sm-3">
                          <img src="/images/components/motherboard.png" alt="CPU" />
                        </div>

                        <div class="col-md-10 col-sm-9">
                          <h6>Motherboard <span class="status" ng-if="post.components.motherboard.status == 'needed'">Lo necesito</span> <span class="status owned" ng-if="post.components.motherboard.status == 'owned'">Ya lo tengo</span></h6>
                          {{ post.components.motherboard.content }}
                        </div>
                      </div>
                    </div>

                    <div ng-if="post.components.cabinet.content" class="component">
                      <div class="row">
                        <div class="col-md-2 col-sm-3">
                          <img src="/images/components/cabinet.png" alt="CPU" />
                        </div>

                        <div class="col-md-10 col-sm-9">
                          <h6>Gabinete <span class="status" ng-if="post.components.cabinet.status == 'needed'">Lo necesito</span> <span class="status owned" ng-if="post.components.cabinet.status == 'owned'">Ya lo tengo</span></h6>
                          {{ post.components.cabinet.content }}
                        </div>
                      </div>
                    </div>

                    <div ng-if="post.components.ram.content" class="component">
                      <div class="row">
                        <div class="col-md-2 col-sm-3">
                          <img src="/images/components/ram.png" alt="CPU" />
                        </div>

                        <div class="col-md-10 col-sm-9">
                          <h6>Memoria RAM <span class="status" ng-if="post.components.ram.status == 'needed'">Lo necesito</span> <span class="status owned" ng-if="post.components.ram.status == 'owned'">Ya lo tengo</span></h6>
                          {{ post.components.ram.content }}
                        </div>
                      </div>
                    </div>

                    <div ng-if="post.components.screen.content" class="component">
                      <div class="row">
                        <div class="col-md-2 col-sm-3">
                          <img src="/images/components/screen.png" alt="CPU" />
                        </div>

                        <div class="col-md-10 col-sm-9">
                          <h6>Monitor <span class="status" ng-if="post.components.screen.status == 'needed'">Lo necesito</span> <span class="status owned" ng-if="post.components.screen.status == 'owned'">Ya lo tengo</span></h6>
                          {{ post.components.screen.content }}
                        </div>
                      </div>
                    </div>

                    <div ng-if="post.components.videocard.content" class="component">
                      <div class="row">
                        <div class="col-md-2 col-sm-3">
                          <img src="/images/components/videocard.png" alt="CPU" />
                        </div>

                        <div class="col-md-10 col-sm-9">
                          <h6>Tarjeta gráfica <span class="status" ng-if="post.components.videocard.status == 'needed'">Lo necesito</span> <span class="status owned" ng-if="post.components.videocard.status == 'owned'">Ya lo tengo</span></h6>
                          {{ post.components.videocard.content }}
                        </div>
                      </div>
                    </div>

                    <div ng-if="post.components.power.content" class="component">
                      <div class="row">
                        <div class="col-md-2 col-sm-3">
                          <img src="/images/components/power.png" alt="CPU" />
                        </div>

                        <div class="col-md-10 col-sm-9">
                          <h6>Fuente de Poder <span class="status" ng-if="post.components.power.status == 'needed'">Lo necesito</span> <span class="status owned" ng-if="post.components.power.status == 'owned'">Ya lo tengo</span></h6>
                          {{ post.components.power.content }}
                        </div>
                      </div>
                    </div>

                    <div ng-if="post.components.storage.content" class="component">
                      <div class="row">
                        <div class="col-md-2 col-sm-3">
                          <img src="/images/components/storage.png" alt="CPU" />
                        </div>

                        <div class="col-md-10 col-sm-9">
                          <h6>Almacenamiento <span class="status" ng-if="post.components.storage.status == 'needed'">Lo necesito</span> <span class="status owned" ng-if="post.components.storage.status == 'owned'">Ya lo tengo</span></h6>
                          {{ post.components.storage.content }}
                        </div>
                      </div>
                    </div>

                    <div ng-if="post.components.cooler.content" class="component">
                      <div class="row">
                        <div class="col-md-2 col-sm-3">
                          <img src="/images/components/cooler.png" alt="CPU" />
                        </div>

                        <div class="col-md-10 col-sm-9">
                          <h6>Enfriamento <span class="status" ng-if="post.components.cooler.status == 'needed'">Lo necesito</span> <span class="status owned" ng-if="post.components.cooler.status == 'owned'">Ya lo tengo</span></h6>
                          {{ post.components.cooler.content }}
                        </div>
                      </div>
                    </div>

                    <div class="component" ng-if="post.components.software">
                      <h6>Programas que utilizaré</h6>
                      {{ post.components.software }}
                    </div>
                  </div>
                </div>

                <div class="votes-count">
                  <span ng-if="post.votes.up > 0">A {{ post.votes.up }} {{post.votes.up == 1 ? 'persona le gusta':'personas les gusta'}}</span>
                  <span ng-if="post.votes.up > 0 && post.votes.down > 0"> y </span>
                  <span ng-if="post.votes.down > 0">{{ post.votes.down }} {{post.votes.down == 1 ? 'persona piensa':'personas piensan'}} que apesta</span>
                </div>

                <ul class="post-actions" ng-class="{empty: post.author.id == user.info.id && post.votes.up == 0 && post.votes.down == 0}">
                  <li class="action" ng-if="post.liked != -1">
                    <a href="" ng-click="post_vote(post, 'up')" class="btn btn-success-border btn-round" ng-class="{'liked': post.liked == 1, 'disabled': user.gaming.tribute == 0}" ng-if="post.author.id != user.info.id"><i class="fa fa-thumbs-up"></i> Me gusta</a>
                  </li>
                  <li class="action" ng-if="post.liked != 1">
                    <a href="" ng-click="post_vote(post, 'down')" ng-class="{'hated': post.liked == -1, 'disabled': user.gaming.shit == 0}" class="btn btn-default btn-round" ng-if="post.author.id != user.info.id"><i class="fa fa-trash"></i> Esto apesta</a>
                  </li>
                </ul>

                <div class="answers">
                  <h5 ng-if="!post.comments_blocked || post.comments.count > 0">{{ post.comments.count }} respuesta{{post.comments.count == 1?'':'s'}}</h5>
                </div>

                <div class="comments">
                  <div class="comment" data-number="{{ comment.position }}" ng-repeat="comment in (post.comments.set | orderBy:'position')" ng-class="{editing: comment.editing, best: comment.chosen}">
                    <div class="float-actions text-right">
                      <div class="btn-group" ng-if="aacl.can('edit', 'comments', user.info, comment.author.id, post.category.id)" dropdown>
                        <button type="button" class="button button-icon button-flat" ng-hide="comment.editing" dropdown-toggle>
                          <i class="fa fa-pencil"></i>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-right">
                          <li>
                            <a href="" ng-class="{disabled: comment.editing}" ng-if="aacl.can('edit', 'comments', user.info, comment.author.id, post.category.id)" ng-click="editCommentShow(comment)"><i class="fa fa-pencil"></i> Editar comentario</a>
                          </li>
                          <li>
                            <a href="" ng-class="{disabled: comment.editing}" ng-if="aacl.can('delete', 'comments', user.info, comment.author.id, post.category.id)" ng-click="deleteComment(comment)"><i class="fa fa-trash-o"></i> Eliminar comentario</a>
                          </li>
                        </ul>
                      </div>
                    </div>
                    <div class="header" ng-if="comment.chosen">
                      <i class="fa fa-check-circle-o"></i> Mejor respuesta
                    </div>
                    <div class="comment-author">
                      <a href="/u/{{ comment.author.username }}/{{ comment.author.id }}" title="Perfil de {{ comment.author.username }}">
                        <img class="avatar" ng-src="{{ comment.author.image }}" alt="{{ comment.author.username }}" ng-if="comment.author.image">
                        <span class="avatar" title="{{ comment.author.username }}" ng-if="!comment.author.image">{{ comment.author.username[0] }}</span>
                      </a>
                      <div class="username">
                        <a href="/u/{{ comment.author.username }}/{{ comment.author.id }}" title="Perfil de {{ comment.author.username }}">
                          <strong>{{ comment.author.username }}</strong>
                        </a>
                        <span class="date dropdown" dropdown auto-close="outsideClick" ng-if="!comment.editing">
                          <a href="" class="dropdown-toggle" dropdown-toggle>
                            <time time-ago from-time='{{ comment.created_at}}'></time>
                          </a>
                          <div class="dropdown-menu post-meta">
                            <span class="number">Comentario #{{ 1 + comment.position }}</span>
                            <span class="time">
                              <time datetime="{{ comment.created_at }}">
                                publicado el {{ comment.created_at | date_at}}
                              </time>
                            </span>
                            <input class="form-control permalink" value="http://spartangeek.com/p/{{ post.slug }}/{{ post.id }}/{{ comment.position }}">
                          </div>
                        </span>

                        <div>
                          <span class="level">{{ misc.gaming.rules[comment.author.level].name }} &#8226;</span> {{ comment.author.description }}
                          <ul class="role-labels" ng-if="comment.author.roles.length > 0">
                            <li ng-repeat="role in comment.author.roles" ng-if="role.name !== 'user'">
                              <span class="label label-default" ng-class="role.name">{{ misc.role_labels[role.name] }}</span>
                            </li>
                          </ul>
                        </div>
                      </div>
                    </div>
                    <div class="content" markedsg="comment.content_final" ng-if="!comment.editing"></div>

                    <div class="actions-count text-right" ng-if="!comment.editing">
                      <span ng-if="comment.votes.up > 0">A {{ comment.votes.up }} {{comment.votes.up == 1 ? 'persona le gusta':'personas les gusta'}} este comentario</span>
                      <span ng-if="comment.votes.up > 0 && comment.votes.down > 0"> y </span>
                      <span ng-if="comment.votes.down > 0">{{ comment.votes.down }} {{comment.votes.down == 1 ? 'persona piensa':'personas piensan'}} que esto apesta</span>
                    </div>
                    <div class="actions text-right" ng-if="user.isLogged && !comment.editing">
                      <ul>
                        <li ng-if="comment.liked != -1 && comment.author.id != user.info.id && user.gaming.tribute > 0">
                          <a href="" ng-click="comment_vote(post.id, comment, 'up')" ng-class="{'liked': comment.liked == 1}"><i class="sgi gray"></i> Me gusta</a>
                        </li>
                        <li ng-if="comment.liked != 1 && comment.author.id != user.info.id && user.gaming.shit > 0">
                          <a href="" ng-click="comment_vote(post.id, comment, 'down')" ng-class="{'hated': comment.liked == -1}"><i class="sgi gray shit"></i> Esto apesta</a>
                        </li>
                        <li ng-if="comment.author.id != user.info.id && !post.comments_blocked">
                          <a href="" ng-click="reply_to(comment.author.username, comment.position)"><i class="fa fa-reply"></i> Responder</a>
                        </li>
                      </ul>
                    </div>

                    <div class="idiot-wizzy edit" ng-if="comment.editing">
                      <textarea id="comment-content" placeholder="Escribe tu comentario..." class="form-control flexible-height content" ng-model="comment.content_edit" ng-disabled="waiting_comment" msd-elastic></textarea>
                      <div class="actions">
                        <ul>
                          <li style="margin-left: 1.5em;">
                            <a href="" class="btn btn-sm btn-danger" ng-click="comment.editing = false"><span class="label">Cancelar</span></a>
                          </li>
                          <li>
                            <a href="" class="btn btn-sm btn-default" ngf-select ngf-change="uploadPicture($files, comment)" ngf-multiple="false" ngf-accept="'image/*'" ng-show="!adding_file"><i class="fa fa-picture-o"></i> <span class="label hidden-xs">Adjuntar imagen</span></a>
                            <a href="" class="btn btn-sm btn-default disabled" ng-show="adding_file"><i class="fa fa-picture-o"></i> <span class="label hidden-xs">Adjuntando imagen...</span></a>
                          </li>
                          <li>
                            <a href="" ng-click="editComment(comment)" ng-class="{'disabled': waiting_comment == true || comment.content == '' || adding_file}" class="btn btn-sm btn-primary btn-comment"><span class="label">Editar</span></a>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="need-signin" ng-if="!user.isLogged && !post.comments_blocked">
                  <p>¿Quieres dejar un comentario? <a href="" ng-click="signIn()">Inicia sesión</a> o <a href="" ng-click="signUp()">Crea una cuenta</a></p>
                </div>
              </div>

              <div class="row">
                <div class="col-md-9">
                  <div ng-if="!post.comments_blocked && user.isLogged">
                    <div class="idiot-wizzy">
                      <textarea id="comment-content" placeholder="Escribe tu comentario..." class="form-control flexible-height content" ng-model="comment.content" ng-disabled="waiting_comment" msd-elastic></textarea>
                      <div class="actions">
                        <ul>
                          <li ng-show="comment.content != ''" class="hidden-xs">
                            <strong>**Negrita**</strong>
                          </li>
                          <li ng-show="comment.content != ''" class="hidden-xs">
                            <em>*Itálica*</em>
                          </li>
                          <li style="margin-left: 1.5em;">
                            <a href="" class="btn btn-default" ngf-select ngf-change="uploadPicture($files)" ngf-multiple="false" ngf-accept="'image/*'" ng-show="!adding_file"><i class="fa fa-picture-o"></i> <span class="label hidden-xs">Adjuntar imagen</span></a>
                            <a href="" class="btn btn-default disabled" ng-show="adding_file"><i class="fa fa-picture-o"></i> <span class="label hidden-xs">Adjuntando imagen...</span></a>
                          </li>
                          <li>
                            <a href="" ng-click="publish()" ng-class="{'disabled': waiting_comment == true || comment.content == '' || adding_file}" class="btn btn-primary btn-comment"><span class="label">Publicar</span></a>
                          </li>
                        </ul>
                      </div>
                    </div>
                  </div>
                  <div ng-if="post.comments_blocked && post.comments.count > 0">
                    <p class="alert alert-warning">Esta publicación no permite más comentarios.</p>
                  </div>
                  <div ng-if="post.comments_blocked && post.comments.count == 0">
                    <p class="alert alert-info">Esta publicación no permite comentarios.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </main>